@use "../../../styles/common/variables" as v;
@use "@/styles/mq" as mq;

/* ---------------- Overlay + Modal ---------------- */

.modalOverlay {
  position: fixed;
  inset: 0;
  z-index: 10;
  background: rgba(0, 0, 0, 0.55);
  display: grid;
  place-items: center;
  padding: 18px;

  /* prevents 1-frame flash */
  opacity: 0;
  animation: overlayFadeIn 220ms ease-out forwards;
  will-change: opacity;
  @include mq.up(desktop) {
    backdrop-filter: blur(10px);
  }
}

@keyframes overlayFadeIn {
  to { opacity: 1; }
}

.modal {
  position: relative;
  width: min(520px, 100%);
  border-radius: 8px;
  padding: 1px;

  background: linear-gradient(180deg, rgba(18, 18, 22, 0.92), rgba(10, 10, 14, 0.92));
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: rgb(10 175 230) 0 0 7px;

  /* initial (matches blurToFocus "from") */
  opacity: 0;
  transform: translateY(6px) scale(0.985);
  filter: blur(2px);
  animation: blurToFocus 0.4s ease-out forwards;

  @include mq.up(desktop) {
    will-change: transform, opacity, filter;
  }

  &::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    z-index: -1;

    background: linear-gradient(
        var(--angle, 0deg),
        #daf6ff,
        #abd1de,
        #53acc9,
        #67aec5,
        #daf6ff,
        #e4aafa
    );

    animation: rotate-hue 4s linear infinite, borderGlow 2s ease infinite;
    filter: blur(1px);
    pointer-events: none;
  }
}

.modalInner {
  background: #19273f;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
}

.modalHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  padding: 20px 20px;

  border-bottom: 1px solid rgba(30, 30, 30, 1);
  background: linear-gradient(#7f94ad38, #0e162500);
  @include mq.up(desktop) {
    padding: 20px 30px;
  }
}

.modalHeaderLeft {
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: flex-start;
}

.titleBox {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0;
}

.modalTitle {
  font-size: 15px;
  font-weight: 900;
  letter-spacing: 0.2px;
  line-height: 1.2;
  @include mq.up(desktop) {
    font-size: 18px;
  }
}

.modalSub {
  font-size: 9px;
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  span:first-child { opacity: 0.6; }
}
.endMsg {
  opacity: 0.6;
}

.count {
  font-weight: 900;
  white-space: nowrap;
  color: v.$orange;
  font-variant-numeric: tabular-nums;
  font-feature-settings: "tnum";
}

.closed {
  color: rgba(255, 120, 120, 0.9);
  font-weight: 800;
}

.pending {
  opacity: 0.5;
}

.iconBtn {
  width: 30px;
  height: 30px;
  border-radius: 5px;
  border: 1px solid rgba(255, 255, 255, 0.10);

  background: rgba(255, 255, 255, 0.06);
  color: rgba(255, 255, 255, 0.85);
  cursor: pointer;
  @include mq.up(desktop) {
    width: 36px;
    height: 36px;
  }
}

/* ---------------- Body ---------------- */

.modalBody {
  border-top: 1px solid #263c63;
  border-bottom: 1px solid #0d1c2c;
  display: flex;
  flex-direction: column;
  padding: 0;
  @include mq.up(desktop) {
    padding: 26px 30px;
    gap: 18px;
  }
}


/* CHANGE number */
.modalBody--changeNumber {
  .selectedNumberBox {
    border: 0 none;
  }
}


.fieldLabelRow {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 10px;
  padding: 0;
  //@include mq.up(desktop) {
  //  padding: 0 12px;
  //}
}

.fieldLabelRowWithHelper {
  padding: 0;
  @include mq.up(desktop) {
    padding: 0 12px;
  }
}


.fieldLabel {
  font-size: 12px;
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  opacity: 0.85;
  @include mq.up(desktop) {
    text-align: left;
    margin-bottom: 6px;
  }
}


.multiToggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.02em;
  color: rgba(255,255,255,0.75);
  transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
  cursor: pointer;

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
}

.label {
  text-transform: uppercase;
}

.switch {
  width: 34px;
  height: 18px;
  background: rgba(255,255,255,0.2);
  border-radius: 999px;
  position: relative;
  transition: background 0.25s ease;
}

.knob {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: white;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: transform 0.25s ease;
}

.on {
  color: white;

  .switch {
    background: rgba(120,180,255,0.9);
  }

  .knob {
    transform: translateX(16px);
  }
}

.off {
  .switch {
    background: rgba(255,255,255,0.25);
  }
}




/* ---------------- Form / Success Switch ---------------- */
.formPane {
  transition: opacity 180ms ease, filter 180ms ease;
}

.formFaded {
  opacity: 0.45;
  filter: blur(1px);
  pointer-events: none;
}



/* ---------------- Footer + Confirm ---------------- */

.modalFooter {
  border-top: 1px solid rgb(38, 60, 99);
  padding: 20px 20px 30px;
  @include mq.up(desktop) {
    border: none;
    padding: 0 32px 30px;
  }
}



.primaryBtn {
  --hue: 50;

  width: 100%;
  padding: 14px 18px;
  border-radius: 10px;

  position: relative;
  isolation: isolate;
  overflow: hidden;

  font-weight: 900;
  font-size: 14px;
  letter-spacing: 0.3px;

  color: rgba(255, 255, 255, 0.95);
  border: 1px solid hsla(var(--hue), 90%, 70%, 0.22);

  cursor: pointer;
  transition: transform 140ms ease, filter 140ms ease, opacity 140ms ease;
}

.primaryBtnActive {
  background:
          radial-gradient(
                          140% 180% at 50% 20%,
                          hsla(var(--hue), 95%, 62%, 0.85),
                          hsla(var(--hue), 90%, 52%, 0.55) 45%,
                          hsla(var(--hue), 85%, 42%, 0.35) 75%,
                          rgba(0, 0, 0, 0.18) 100%
          ),
          linear-gradient(
                          180deg,
                          hsla(var(--hue), 88%, 55%, 0.75),
                          hsla(var(--hue), 78%, 38%, 0.65)
          );

  box-shadow:
          0 16px 44px rgba(0, 0, 0, 0.45),
          0 0 34px hsla(var(--hue), 95%, 60%, 0.25),
          inset 0 1px 0 rgba(255, 255, 255, 0.18),
          inset 0 -8px 18px rgba(0, 0, 0, 0.25);
}

.primaryBtnActive::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;

  background: radial-gradient(
                  120% 160% at 50% 0%,
                  rgba(255, 255, 255, 0.22),
                  transparent 60%
  );


  @include mq.up(desktop) {
    mix-blend-mode: overlay;
  }
}

.primaryBtnActive:hover {
  transform: translateY(-1px);
  filter: brightness(1.18) saturate(1.08);
  box-shadow:
          0 18px 48px rgba(0, 0, 0, 0.5),
          0 0 44px hsla(var(--hue), 95%, 62%, 0.35);
}

.primaryBtnActive:active {
  transform: translateY(0px) scale(0.985);
  filter: brightness(0.95);
}

.primaryBtnDisabled,
.primaryBtn:disabled {
  opacity: 0.40;
  cursor: not-allowed;
  filter: saturate(0.65);
  box-shadow: none;
  background: rgba(255, 255, 255, 0.06);
  border-color: rgba(255, 255, 255, 0.12);
}

.processing {
  opacity: 0.88;
  cursor: not-allowed;
}

/* Full button animated candy-cane overlay */
.processing::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: 1; // above gradients, below text

  /* muted tint so it feels "in progress" but still your hue */
  background-image: repeating-linear-gradient(
      45deg,
      hsla(var(--hue), 95%, 80%, 0.16) 0 10px,
      hsla(var(--hue), 70%, 40%, 0.10) 10px 20px
  );

  /* IMPORTANT: animate background-position by EXACT tile size => no seam/stutter */
  background-size: 56px 56px;
  animation: candySlide 0.75s linear infinite;
  opacity: 0.7;
  @include mq.up(desktop) {
    /* keep it dull */
    mix-blend-mode: overlay;
  }
}

/* Ensure button content is above overlay */
.processing .btnProgress,
.processing .btnProgressText,
.processing > span,
.processing > * {
  position: relative;
  z-index: 2;
}

@keyframes candySlide {
  from { background-position: 0 0; }
  to   { background-position: 56px 0; }
}






/* ---------------- Closing animations ---------------- */
.formPane,
.successPane {
  position: relative;
}



.stage {
  position: relative;
}

/* Stack both panes on top of each other */
.formPane,
.successPane {
  position: relative;
}

.successPane {
  position: relative;
  inset: 0;
  display: grid;
  place-items: center;
  pointer-events: none; /* clicks go to form unless success is active */
  opacity: 0;
  transform: translateY(10px) scale(0.98);
  filter: blur(10px);
}

/* Success becomes interactive when visible */
.successIn {
  pointer-events: auto;
  animation: successFadeIn 260ms cubic-bezier(0.22, 1, 0.36, 1) forwards;
  animation-delay: 70ms;
}

.successHidden {
  opacity: 0;
  display: none;
}

/* Form fades out when success */
.formOut {
  animation: formFadeOut 220ms ease forwards;
  pointer-events: none;

  position: absolute;
  inset: 0;
}



@keyframes formFadeOut {
  to {
    opacity: 0;
    transform: translateY(4px) scale(0.985);
    filter: blur(6px);
  }
}

@keyframes successFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.97);
    filter: blur(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}